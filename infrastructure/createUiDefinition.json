{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "basics": [
      {
        "name": "resourcePrefix",
        "type": "Microsoft.Common.TextBox",
        "label": "Resource Prefix",
        "defaultValue": "contentrec",
        "toolTip": "Prefix for all resource names (2-10 characters, lowercase only)",
        "constraints": {
          "required": true,
          "regex": "^[a-z0-9]{2,10}$",
          "validationMessage": "Must be 2-10 characters, lowercase letters and numbers only"
        }
      },
      {
        "name": "environment",
        "type": "Microsoft.Common.DropDown",
        "label": "Environment",
        "defaultValue": "Development",
        "toolTip": "Select the environment type for this deployment",
        "constraints": {
          "allowedValues": [
            {
              "label": "Development",
              "value": "dev"
            },
            {
              "label": "Staging",
              "value": "staging"
            },
            {
              "label": "Production",
              "value": "prod"
            }
          ],
          "required": true
        }
      }
    ],
    "steps": [
      {
        "name": "identity",
        "label": "Identity & Access",
        "elements": [
          {
            "name": "identityInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "You need to provide your Azure AD Object ID to grant you access to deployed resources. Find it in Azure Portal > Azure Active Directory > Users > [Your User] > Object ID"
            }
          },
          {
            "name": "principalId",
            "type": "Microsoft.Common.TextBox",
            "label": "Your Azure AD Object ID",
            "toolTip": "Your Azure AD Object ID (GUID format)",
            "placeholder": "00000000-0000-0000-0000-000000000000",
            "constraints": {
              "required": true,
              "regex": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$",
              "validationMessage": "Must be a valid GUID (Azure AD Object ID)"
            }
          },
          {
            "name": "principalType",
            "type": "Microsoft.Common.DropDown",
            "label": "Principal Type",
            "defaultValue": "User",
            "toolTip": "Select User for individual access, ServicePrincipal for automation",
            "constraints": {
              "allowedValues": [
                {
                  "label": "User",
                  "value": "User"
                },
                {
                  "label": "Service Principal",
                  "value": "ServicePrincipal"
                }
              ],
              "required": true
            }
          }
        ]
      },
      {
        "name": "configuration",
        "label": "Configuration",
        "elements": [
          {
            "name": "configInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "This deployment will create: Azure OpenAI, AI Search, Cosmos DB, Storage Accounts, Azure ML Workspace, Synapse Analytics, Key Vault, Application Insights, and Function Apps. Estimated deployment time: 15-20 minutes."
            }
          },
          {
            "name": "deploymentDetails",
            "type": "Microsoft.Common.Section",
            "label": "What will be deployed?",
            "elements": [
              {
                "name": "servicesText",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "✓ Azure OpenAI Service (GPT-4 + Embeddings)\n✓ Azure AI Search (Vector Search)\n✓ Azure Cosmos DB (NoSQL Database)\n✓ Azure Storage Accounts (Data Lake + Blob)\n✓ Azure Machine Learning Workspace\n✓ Azure Synapse Analytics\n✓ Azure Key Vault (Secrets Management)\n✓ Application Insights (Monitoring)\n✓ Azure Functions (2 Function Apps)\n✓ Virtual Network (Private Endpoints)\n✓ Log Analytics Workspace"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "location": "[location()]",
      "resourcePrefix": "[basics('resourcePrefix')]",
      "environment": "[basics('environment')]",
      "principalId": "[steps('identity').principalId]",
      "principalType": "[steps('identity').principalType]"
    }
  }
}
